import { Appear, Head, Image } from 'mdx-deck'
import { highlight, book, code, dark, future } from '@mdx-deck/themes'
import customTheme from './theme'
import freelanceLogo from './img/julian-logo.png'
import imgRichText from './img/rich-text.png'
import imgReact from './img/react-icon.png'
import imgMedium from './img/medium.png'
import imgNotion from './img/notion.png'
import imgNoCode from './img/nocode_logos.png'
import imgGoogleDocs from './img/google-docs.png'
import imgPaper from './img/paper.png'
import imgTettra from './img/tettra.png'
import imgTwitter from './img/twitter-editor.png'
import './index.css'

export const themes = [highlight, customTheme]

---

## Editing the world
## ✏️
## with Zettel and React

---

## :wave: I'm Julian

<Appear>

I'm a freelance software engineer 

<span className="hire-me">reactrocket.com</span>

✎ I specialize in building editors

</Appear>

---

<Appear>
<div className="stack rotate-1"><img src={imgTettra} /></div>
<img src={imgRichText} />
<span className="badge">Sort of ...</span>
<div className="stack rotate-1"><img src={imgGoogleDocs} /></div>
<div className="stack rotate-2"><img src={imgMedium} /></div>
<div className="stack rotate-3"><img src={imgTwitter} /></div>
<div className="stack rotate-4"><img src={imgNotion} /></div>
</Appear>

---

## This talk is about
## writing editors with <img width="80" src={imgReact} /> React 

---

## What do I mean by editors?

<Appear>

Not `<textarea />`

Not `<input />`

</Appear>

---


## Why should we care?

<Appear>

Nocode is a big thing now

<img src={imgNoCode} />

</Appear>

--- 

## `contentEditable`

<Appear>

Originally developed by Microsoft  (ca 1999)

Other browsers implement without spec

The w3 spec is still a draft

</Appear>

---

## Draft js to the rescue

<Appear>

Actively used at facebook

Stable

Easy to read source code, typed

</Appear>

---

## The problem(s) with draft

<Appear>

It is large (147kb minified)

Depends on Immutable.js (also a large dependency)

Complicated, inflexible API, not actively developed

</Appear>

---

## Updating trees is hard

Editing frameworks are typically based on tree structures

---

<div contentEditable={true} style={{display: 'flex', justifyContent: 'space-between', paddingRight: '3em', alignItems: 'center' }}>
<small >

```js
[{
  text: 'One',
}, {
  text: 'Two',
  children: [{
    text: 'Three'
  }]
}]
```

</small>

<div>

  - One
  - Two
    - Three

</div>
</div>

---
<div>
<div contentEditable={true} style={{marginTop: '-2em', fontSize: '0.8em', display: 'flex', justifyContent: 'space-between', paddingRight: '3em', alignItems: 'center' }}>

```js
[{
  text: 'One',
}, {
  text: 'Two',
  children: [{
    text: 'Three'
  }]
}]
```

<div style={{display: 'inline-block', padding: 60}}></div>

```js
[{
  text: 'One',
}, {
  text: 'Tree'
}]
```
</div>

<small style={{ marginTop: '-4em', paddingTop: 0 }}>

```
{ startIndex: 1, startOffset: 1,
  endIndex: [1,1], endOffset: 1 }
```

</small>
</div>

---

```
{ startIndex: 1, startOffset: 1,
  endIndex: [1,1], endOffset: 1 }
```

<ol>
  <Appear>
    <li>Find selected elements in a tree of (n) depth</li>
    <li>Remove the blocks in between</li>
    <li>Update blocks to remove text</li>
    <li>Join the blocks together</li>
  </Appear>
</ol>

---

## Updating text is easy

---

<div contentEditable={true} style={{display: 'flex', justifyContent: 'space-between', paddingRight: '3em', alignItems: 'center' }}>
<small >

```js
[One]
[Two
[Three]]
```

</small>

<div>

  - One
  - Two
    - Three

</div>
</div>

```
text.slice(0, 4) + string.slice(9, 12)
```

---

### Introducing Zettel

- Written in typescript :rocket:
- It's tiny - currently sub 30kb minified
- 0 dependencies :tada:
- State module can be used with any framework
- Changes are atomic - replayable and serializable


---

## Why?

<Appear>

I just like doing this stuff

It's good timing, technology wise and industry wise

</Appear>

---

## Disclaimer

- DO :fire: NOT :fire: USE :fire: IN :fire: PRODUCTION 
- I'm the only one working on it (atm)
- Intentionally very little test coverage.
- I welcome contributions and sponsorship, please reach out if interested.
- Only partial mobile support

---

## Approach

<Appear>

Minimal testing
Fast Prototyping
Open source -> github.com/juliankrispel/*zettel*

</Appear>

---

## Data model

- Flat data structure for state
- ^ Generates tree data structure for rendering

---

```
[One[Two]]
```

Becomes 

```
[{ text: 'One', children: [{ text: 'Two'}]}]
```

---

## The Change Object

```typescript
type Change = {
  start: number,
  end: number,
  value: Value
}
```

--- 

Naive implementation of `change(Change)`:

```
const { start, end, value } = change

const newValue =
  text.slice(0, start)
  .concat(value)
  .concat(text.slice(end, text.length))
```

---

## Changing selection 

```js
{
  start: 3,
  end: 8
}
```

---

## Inserting text 

```js
{
  start: 3,
  end: 3,
  value: 'Hello Kyiv'
}
```

---

## Replacing text 

```js
{
  start: 3,
  end: 9,
  value: 'Goodbye Kyiv'
}
```

---

## Inserting styled text 

<div style={{ fontSize: 22 }}>

```js
{
  start: 3,
  end: 3,
  value: [{
    char: 'H',
    styles: ['bold']
  }, {
    char: 'i',
    styles: ['bold']
  }]
}
```

</div>

---

## Inserting a new block

<div style={{ fontSize: 26 }}>

```js
{ start: 3,
  end: 3,
  value: [
    { type: 'block-start' },
    { char: 'H' },
    { char: 'i' },
    { type: 'block-end' }]}
```

</div>

---

## Inserting a custom block

<div style={{ fontSize: 28 }}>

```js
{
  start: 3,
  end: 3,
  value: [{
    type: 'block',
    type: 'youtube',
    data: { src: 'http://somelink' }}]}
```

</div>

---

## Live coding time :fire:

---

## Roadmap

- Android support (via level 2 input events)
- Prototype collaborative editing
- Automated browser testing
- Alternative view layers (vuejs/svelte/angular)

---

### That's it thanks for listening :pray:

- Twitter: @juliandoesstuff
- Github: juliankrispel/zettel
